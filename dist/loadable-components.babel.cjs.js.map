{"version":3,"file":"loadable-components.babel.cjs.js","sources":["../src/babel.js"],"sourcesContent":["import syntax from 'babel-plugin-syntax-dynamic-import'\n\nexport default function({ types: t }) {\n  return {\n    inherits: syntax,\n\n    visitor: {\n      ImportDeclaration(path, state) {\n        const source = path.node.source.value\n        const triggerModule = state.opts.triggerModule || 'loadable-components'\n        if (source !== triggerModule) return\n        const triggerImport = state.opts.triggerImport || 'loadable'\n        const defaultSpecifier = path\n          .get('specifiers')\n          .find(specifier => specifier.node.local.name === triggerImport)\n\n        if (!defaultSpecifier) return\n\n        const bindingName = defaultSpecifier.node.local.name\n        const binding = path.scope.getBinding(bindingName)\n\n        binding.referencePaths.forEach(refPath => {\n          let callExpression = refPath.parentPath\n\n          if (\n            callExpression.isMemberExpression() &&\n            callExpression.node.computed === false &&\n            callExpression.get('property').isIdentifier({ name: 'Map' })\n          ) {\n            callExpression = callExpression.parentPath\n          }\n\n          if (!callExpression.isCallExpression()) return\n\n          const args = callExpression.get('arguments')\n          const loaderMethod = args[0]\n\n          if (!loaderMethod) return\n\n          const dynamicImports = []\n\n          loaderMethod.traverse({\n            Import({ parentPath }) {\n              dynamicImports.push(parentPath)\n            },\n          })\n\n          if (!dynamicImports.length) return\n\n          const dynamicImportArray = t.arrayExpression(\n            dynamicImports.map(\n              dynamicImport => dynamicImport.get('arguments')[0].node,\n            ),\n          )\n\n          const assignToFn = t.VariableDeclaration('const', [\n            t.VariableDeclarator(t.Identifier('fn'), loaderMethod.node),\n          ])\n\n          const addModuleArray = t.ExpressionStatement(\n            t.AssignmentExpression(\n              '=',\n              t.Identifier('fn.modules'),\n              dynamicImportArray,\n            ),\n          )\n\n          const test = t.ArrowFunctionExpression(\n            [],\n            t.BlockStatement([\n              assignToFn,\n              addModuleArray,\n              t.ReturnStatement(t.Identifier('fn')),\n            ]),\n          )\n\n          const selfcall = t.CallExpression(test, [])\n\n          loaderMethod.replaceWith(selfcall)\n        })\n      },\n    },\n  }\n}\n"],"names":["t","types","syntax","path","state","source","node","value","triggerModule","opts","triggerImport","defaultSpecifier","get","find","specifier","local","name","bindingName","binding","scope","getBinding","referencePaths","forEach","callExpression","refPath","parentPath","isMemberExpression","computed","isIdentifier","isCallExpression","args","loaderMethod","dynamicImports","traverse","push","length","dynamicImportArray","arrayExpression","map","dynamicImport","assignToFn","VariableDeclaration","VariableDeclarator","Identifier","addModuleArray","ExpressionStatement","AssignmentExpression","test","ArrowFunctionExpression","BlockStatement","ReturnStatement","selfcall","CallExpression","replaceWith"],"mappings":";;;;;;;;AAEe,sBAAuB;MAALA,CAAK,QAAZC,KAAY;;SAC7B;cACKC,MADL;;aAGI;uBAAA,6BACWC,IADX,EACiBC,KADjB,EACwB;YACvBC,SAASF,KAAKG,IAAL,CAAUD,MAAV,CAAiBE,KAAhC;YACMC,gBAAgBJ,MAAMK,IAAN,CAAWD,aAAX,IAA4B,qBAAlD;YACIH,WAAWG,aAAf,EAA8B;YACxBE,gBAAgBN,MAAMK,IAAN,CAAWC,aAAX,IAA4B,UAAlD;YACMC,mBAAmBR,KACtBS,GADsB,CAClB,YADkB,EAEtBC,IAFsB,CAEjB;iBAAaC,UAAUR,IAAV,CAAeS,KAAf,CAAqBC,IAArB,KAA8BN,aAA3C;SAFiB,CAAzB;;YAII,CAACC,gBAAL,EAAuB;;YAEjBM,cAAcN,iBAAiBL,IAAjB,CAAsBS,KAAtB,CAA4BC,IAAhD;YACME,UAAUf,KAAKgB,KAAL,CAAWC,UAAX,CAAsBH,WAAtB,CAAhB;;gBAEQI,cAAR,CAAuBC,OAAvB,CAA+B,mBAAW;cACpCC,iBAAiBC,QAAQC,UAA7B;;cAGEF,eAAeG,kBAAf,MACAH,eAAejB,IAAf,CAAoBqB,QAApB,KAAiC,KADjC,IAEAJ,eAAeX,GAAf,CAAmB,UAAnB,EAA+BgB,YAA/B,CAA4C,EAAEZ,MAAM,KAAR,EAA5C,CAHF,EAIE;6BACiBO,eAAeE,UAAhC;;;cAGE,CAACF,eAAeM,gBAAf,EAAL,EAAwC;;cAElCC,OAAOP,eAAeX,GAAf,CAAmB,WAAnB,CAAb;cACMmB,eAAeD,KAAK,CAAL,CAArB;;cAEI,CAACC,YAAL,EAAmB;;cAEbC,iBAAiB,EAAvB;;uBAEaC,QAAb,CAAsB;kBAAA,yBACG;kBAAdR,UAAc,SAAdA,UAAc;;6BACNS,IAAf,CAAoBT,UAApB;;WAFJ;;cAMI,CAACO,eAAeG,MAApB,EAA4B;;cAEtBC,qBAAqBpC,EAAEqC,eAAF,CACzBL,eAAeM,GAAf,CACE;mBAAiBC,cAAc3B,GAAd,CAAkB,WAAlB,EAA+B,CAA/B,EAAkCN,IAAnD;WADF,CADyB,CAA3B;;cAMMkC,aAAaxC,EAAEyC,mBAAF,CAAsB,OAAtB,EAA+B,CAChDzC,EAAE0C,kBAAF,CAAqB1C,EAAE2C,UAAF,CAAa,IAAb,CAArB,EAAyCZ,aAAazB,IAAtD,CADgD,CAA/B,CAAnB;;cAIMsC,iBAAiB5C,EAAE6C,mBAAF,CACrB7C,EAAE8C,oBAAF,CACE,GADF,EAEE9C,EAAE2C,UAAF,CAAa,YAAb,CAFF,EAGEP,kBAHF,CADqB,CAAvB;;cAQMW,OAAO/C,EAAEgD,uBAAF,CACX,EADW,EAEXhD,EAAEiD,cAAF,CAAiB,CACfT,UADe,EAEfI,cAFe,EAGf5C,EAAEkD,eAAF,CAAkBlD,EAAE2C,UAAF,CAAa,IAAb,CAAlB,CAHe,CAAjB,CAFW,CAAb;;cASMQ,WAAWnD,EAAEoD,cAAF,CAAiBL,IAAjB,EAAuB,EAAvB,CAAjB;;uBAEaM,WAAb,CAAyBF,QAAzB;SAzDF;;;GAlBN;;;;;"}